class_name Invulnerability
extends Node3D

@onready var particles: GPUParticles3D = $Particles

var _time: float
var _health: Health


func _enter_tree() -> void:
	owner.set_meta("Invulnerability", self)


func _ready() -> void:
	if owner.has_meta("Health"):
		_health = (owner.get_meta("Health") as Health)


func _process(delta: float) -> void:
	if _health and _health.is_invulnerable:
		_time -= delta
		if _time <= 0:
			#print("no longer invulnerable")
			_health.is_invulnerable = false


func activate(duration: float) -> void:
	if _health:
		_time = duration
		_health.is_invulnerable = true
		particles.restart()
